<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç™½çš„æ’ä»¶å¸‚åœº - æäº¤æ’ä»¶</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <style>
        [x-cloak] { display: none !important; }
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .card-shadow {
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
        }
    </style>
</head>
<body class="min-h-screen bg-gray-50">
    <div x-data="pluginSubmit()" class="min-h-screen">
        <!-- é¡¶éƒ¨æ¨ªå¹… -->
        <div class="gradient-bg text-white py-12 px-4">
            <div class="max-w-4xl mx-auto text-center">
                <div class="inline-flex items-center justify-center w-20 h-20 bg-white/20 rounded-2xl mb-4">
                    <span class="text-5xl">ğŸª</span>
                </div>
                <h1 class="text-4xl font-bold mb-2">ç™½çš„æ’ä»¶å¸‚åœº</h1>
                <p class="text-white/80 text-lg">æäº¤ä½ çš„æ’ä»¶ï¼Œä¸æ‰€æœ‰ç™½çš„ç”¨æˆ·åˆ†äº«</p>
            </div>
        </div>
        
        <!-- ä¸»å†…å®¹ -->
        <div class="max-w-4xl mx-auto px-4 -mt-8 pb-12">
            <div class="bg-white rounded-2xl card-shadow overflow-hidden">
                <!-- æ­¥éª¤æŒ‡ç¤ºå™¨ -->
                <div class="bg-gray-50 px-6 py-4 border-b flex items-center justify-center gap-4">
                    <div class="flex items-center gap-2" :class="step >= 1 ? 'text-purple-600' : 'text-gray-400'">
                        <span class="w-8 h-8 rounded-full flex items-center justify-center text-sm font-bold" 
                              :class="step >= 1 ? 'bg-purple-600 text-white' : 'bg-gray-200'">1</span>
                        <span class="font-medium">åŸºæœ¬ä¿¡æ¯</span>
                    </div>
                    <div class="w-12 h-0.5" :class="step >= 2 ? 'bg-purple-600' : 'bg-gray-200'"></div>
                    <div class="flex items-center gap-2" :class="step >= 2 ? 'text-purple-600' : 'text-gray-400'">
                        <span class="w-8 h-8 rounded-full flex items-center justify-center text-sm font-bold"
                              :class="step >= 2 ? 'bg-purple-600 text-white' : 'bg-gray-200'">2</span>
                        <span class="font-medium">åŠŸèƒ½æè¿°</span>
                    </div>
                    <div class="w-12 h-0.5" :class="step >= 3 ? 'bg-purple-600' : 'bg-gray-200'"></div>
                    <div class="flex items-center gap-2" :class="step >= 3 ? 'text-purple-600' : 'text-gray-400'">
                        <span class="w-8 h-8 rounded-full flex items-center justify-center text-sm font-bold"
                              :class="step >= 3 ? 'bg-purple-600 text-white' : 'bg-gray-200'">3</span>
                        <span class="font-medium">æ’ä»¶ä»£ç </span>
                    </div>
                </div>
                
                <!-- è¡¨å•å†…å®¹ -->
                <div class="p-6">
                    <!-- æ­¥éª¤1ï¼šåŸºæœ¬ä¿¡æ¯ -->
                    <div x-show="step === 1" x-transition>
                        <h2 class="text-xl font-bold text-gray-800 mb-6 flex items-center gap-2">
                            <span class="text-2xl">ğŸ“</span> åŸºæœ¬ä¿¡æ¯
                        </h2>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">
                                    æ’ä»¶ID <span class="text-red-500">*</span>
                                    <span class="text-gray-400 font-normal text-xs">ï¼ˆè‹±æ–‡ï¼Œå¦‚ my_pluginï¼‰</span>
                                </label>
                                <input type="text" x-model="form.id" placeholder="my_awesome_plugin"
                                       class="w-full px-4 py-3 rounded-xl border border-gray-200 focus:border-purple-400 focus:ring-2 focus:ring-purple-100 transition-all">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">
                                    æ’ä»¶åç§° <span class="text-red-500">*</span>
                                    <span class="text-gray-400 font-normal text-xs">ï¼ˆä¸­æ–‡æ˜¾ç¤ºåï¼‰</span>
                                </label>
                                <input type="text" x-model="form.cn_name" placeholder="æˆ‘çš„è¶…æ£’æ’ä»¶"
                                       class="w-full px-4 py-3 rounded-xl border border-gray-200 focus:border-purple-400 focus:ring-2 focus:ring-purple-100 transition-all">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">
                                    ä½œè€…åç§° <span class="text-red-500">*</span>
                                </label>
                                <input type="text" x-model="form.author" placeholder="ä½ çš„åå­—æˆ–æ˜µç§°"
                                       class="w-full px-4 py-3 rounded-xl border border-gray-200 focus:border-purple-400 focus:ring-2 focus:ring-purple-100 transition-all">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">ç‰ˆæœ¬å·</label>
                                <input type="text" x-model="form.version" placeholder="1.0.0"
                                       class="w-full px-4 py-3 rounded-xl border border-gray-200 focus:border-purple-400 focus:ring-2 focus:ring-purple-100 transition-all">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">åˆ†ç±»</label>
                                <select x-model="form.category"
                                        class="w-full px-4 py-3 rounded-xl border border-gray-200 focus:border-purple-400 focus:ring-2 focus:ring-purple-100 transition-all">
                                    <option value="å¨±ä¹">ğŸ® å¨±ä¹</option>
                                    <option value="å·¥å…·">ğŸ”§ å·¥å…·</option>
                                    <option value="ä¿¡æ¯">ğŸ“° ä¿¡æ¯</option>
                                    <option value="ç¤¾äº¤">ğŸ’¬ ç¤¾äº¤</option>
                                    <option value="åª’ä½“">ğŸ“º åª’ä½“</option>
                                    <option value="è‡ªåŠ¨åŒ–">âš¡ è‡ªåŠ¨åŒ–</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">
                                    ç®€çŸ­ä»‹ç» <span class="text-red-500">*</span>
                                </label>
                                <input type="text" x-model="form.description" placeholder="ä¸€å¥è¯æè¿°ä½ çš„æ’ä»¶"
                                       class="w-full px-4 py-3 rounded-xl border border-gray-200 focus:border-purple-400 focus:ring-2 focus:ring-purple-100 transition-all">
                            </div>
                        </div>
                    </div>
                    
                    <!-- æ­¥éª¤2ï¼šåŠŸèƒ½æè¿° -->
                    <div x-show="step === 2" x-transition x-cloak>
                        <h2 class="text-xl font-bold text-gray-800 mb-6 flex items-center gap-2">
                            <span class="text-2xl">âœ¨</span> åŠŸèƒ½æè¿°
                        </h2>
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">è¯¦ç»†ä»‹ç»</label>
                                <textarea x-model="form.full_description" rows="3" placeholder="è¯¦ç»†æè¿°ä½ çš„æ’ä»¶åŠŸèƒ½..."
                                          class="w-full px-4 py-3 rounded-xl border border-gray-200 focus:border-purple-400 focus:ring-2 focus:ring-purple-100 transition-all"></textarea>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">
                                    åŠŸèƒ½ç‰¹è‰² <span class="text-gray-400 font-normal text-xs">ï¼ˆæ¯è¡Œä¸€ä¸ªï¼‰</span>
                                </label>
                                <textarea x-model="form.features_text" rows="4" placeholder="ğŸ² æ”¯æŒå¤šç§éª°å­ç±»å‹&#10;ğŸ”¢ å¯ä»¥åŒæ—¶æŠ•æ·å¤šä¸ªéª°å­&#10;ğŸ“Š è‡ªåŠ¨ç»Ÿè®¡ç»“æœ"
                                          class="w-full px-4 py-3 rounded-xl border border-gray-200 focus:border-purple-400 focus:ring-2 focus:ring-purple-100 transition-all font-mono text-sm"></textarea>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">ä½¿ç”¨æ–¹æ³•</label>
                                <textarea x-model="form.usage" rows="2" placeholder="å¯¹ç™½è¯´ã€Œxxxã€å³å¯è§¦å‘..."
                                          class="w-full px-4 py-3 rounded-xl border border-gray-200 focus:border-purple-400 focus:ring-2 focus:ring-purple-100 transition-all"></textarea>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">
                                    è§¦å‘å‘½ä»¤ <span class="text-gray-400 font-normal text-xs">ï¼ˆç”¨é€—å·åˆ†éš”ï¼‰</span>
                                </label>
                                <input type="text" x-model="form.commands_text" placeholder="å‘½ä»¤1, å‘½ä»¤2, å‘½ä»¤3"
                                       class="w-full px-4 py-3 rounded-xl border border-gray-200 focus:border-purple-400 focus:ring-2 focus:ring-purple-100 transition-all">
                            </div>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">æ›´æ–°æ—¥å¿—</label>
                                    <input type="text" x-model="form.changelog" placeholder="v1.0.0 - åˆå§‹ç‰ˆæœ¬"
                                           class="w-full px-4 py-3 rounded-xl border border-gray-200 focus:border-purple-400 focus:ring-2 focus:ring-purple-100 transition-all">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">æ³¨æ„äº‹é¡¹</label>
                                    <input type="text" x-model="form.notes" placeholder="ä½¿ç”¨æ—¶éœ€è¦æ³¨æ„çš„åœ°æ–¹..."
                                           class="w-full px-4 py-3 rounded-xl border border-gray-200 focus:border-purple-400 focus:ring-2 focus:ring-purple-100 transition-all">
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- æ­¥éª¤3ï¼šæ’ä»¶ä»£ç  -->
                    <div x-show="step === 3" x-transition x-cloak>
                        <h2 class="text-xl font-bold text-gray-800 mb-6 flex items-center gap-2">
                            <span class="text-2xl">ğŸ’»</span> æ’ä»¶ä»£ç 
                        </h2>
                        <div class="relative">
                            <div class="absolute top-2 right-2 z-10">
                                <button @click="loadTemplate()" class="px-4 py-2 bg-purple-100 text-purple-600 rounded-lg text-sm hover:bg-purple-200 transition-colors">
                                    ğŸ“„ åŠ è½½æ¨¡æ¿
                                </button>
                            </div>
                            <textarea x-model="form.code" rows="20" placeholder="# åœ¨è¿™é‡Œç²˜è´´ä½ çš„ plugin.py ä»£ç ..."
                                      class="w-full px-4 py-3 rounded-xl border border-gray-200 focus:border-purple-400 focus:ring-2 focus:ring-purple-100 transition-all font-mono text-sm bg-gray-900 text-green-400"></textarea>
                        </div>
                        <p class="text-sm text-gray-500 mt-2">ğŸ’¡ æç¤ºï¼šç‚¹å‡»ã€ŒåŠ è½½æ¨¡æ¿ã€å¯ä»¥è·å–æ ‡å‡†çš„æ’ä»¶ä»£ç æ¨¡æ¿</p>
                    </div>
                </div>
                
                <!-- åº•éƒ¨æŒ‰é’® -->
                <div class="px-6 py-4 bg-gray-50 border-t flex items-center justify-between">
                    <button x-show="step > 1" @click="step--" 
                            class="px-6 py-3 rounded-xl border border-gray-200 text-gray-600 hover:bg-white transition-colors">
                        â† ä¸Šä¸€æ­¥
                    </button>
                    <div x-show="step === 1"></div>
                    
                    <button x-show="step < 3" @click="nextStep()"
                            class="px-6 py-3 rounded-xl bg-purple-600 text-white hover:bg-purple-700 transition-colors">
                        ä¸‹ä¸€æ­¥ â†’
                    </button>
                    <button x-show="step === 3" @click="submit()" :disabled="submitting"
                            :class="submitting ? 'bg-gray-400 cursor-wait' : 'bg-green-600 hover:bg-green-700'"
                            class="px-8 py-3 rounded-xl text-white transition-colors flex items-center gap-2">
                        <span x-show="submitting" class="animate-spin">â³</span>
                        <span x-text="submitting ? 'æäº¤ä¸­...' : 'ğŸš€ æäº¤æ’ä»¶'"></span>
                    </button>
                </div>
            </div>
            
            <!-- æç¤ºä¿¡æ¯ -->
            <div class="mt-6 bg-blue-50 rounded-xl p-4 border border-blue-100">
                <h3 class="font-medium text-blue-800 flex items-center gap-2">
                    <span>ğŸ’¡</span> æäº¤é¡»çŸ¥
                </h3>
                <ul class="mt-2 text-sm text-blue-700 space-y-1">
                    <li>â€¢ æ’ä»¶æäº¤åä¼šè‡ªåŠ¨åŒæ­¥åˆ°æ’ä»¶å¸‚åœº</li>
                    <li>â€¢ è¯·ç¡®ä¿ä»£ç å¯æ­£å¸¸è¿è¡Œï¼Œä¸åŒ…å«æ¶æ„å†…å®¹</li>
                    <li>â€¢ æ’ä»¶IDå¿…é¡»æ˜¯å”¯ä¸€çš„ï¼Œåªèƒ½åŒ…å«å°å†™å­—æ¯ã€æ•°å­—å’Œä¸‹åˆ’çº¿</li>
                </ul>
            </div>
        </div>
        
        <!-- Toast æç¤º -->
        <div x-show="toast.show" x-transition x-cloak
             class="fixed bottom-6 right-6 px-6 py-4 rounded-xl shadow-lg"
             :class="toast.type === 'success' ? 'bg-green-500 text-white' : 'bg-red-500 text-white'">
            <span x-text="toast.message"></span>
        </div>
        
        <!-- æˆåŠŸå¼¹çª— -->
        <div x-show="showSuccess" x-cloak class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4">
            <div class="bg-white rounded-2xl p-8 max-w-md text-center">
                <div class="text-6xl mb-4">ğŸ‰</div>
                <h2 class="text-2xl font-bold text-gray-800 mb-2">æäº¤æˆåŠŸï¼</h2>
                <p class="text-gray-600 mb-6">ä½ çš„æ’ä»¶å·²ç»æäº¤åˆ°æ’ä»¶å¸‚åœºï¼Œæ‰€æœ‰ç”¨æˆ·ç°åœ¨éƒ½èƒ½çœ‹åˆ°äº†ï¼</p>
                <button @click="showSuccess = false; resetForm()" 
                        class="px-8 py-3 bg-purple-600 text-white rounded-xl hover:bg-purple-700 transition-colors">
                    ç»§ç»­æäº¤
                </button>
            </div>
        </div>
    </div>
    
    <script>
    function pluginSubmit() {
        return {
            step: 1,
            submitting: false,
            showSuccess: false,
            toast: { show: false, message: '', type: 'success' },
            form: {
                id: '',
                cn_name: '',
                author: '',
                version: '1.0.0',
                category: 'å¨±ä¹',
                description: '',
                full_description: '',
                features_text: '',
                usage: '',
                commands_text: '',
                changelog: 'v1.0.0 - åˆå§‹ç‰ˆæœ¬',
                notes: '',
                code: ''
            },
            
            showToast(message, type = 'success') {
                this.toast = { show: true, message, type };
                setTimeout(() => this.toast.show = false, 3000);
            },
            
            nextStep() {
                if (this.step === 1) {
                    if (!this.form.id || !this.form.cn_name || !this.form.author || !this.form.description) {
                        this.showToast('è¯·å¡«å†™æ‰€æœ‰å¿…å¡«é¡¹', 'error');
                        return;
                    }
                    if (!/^[a-z][a-z0-9_]*$/.test(this.form.id)) {
                        this.showToast('æ’ä»¶IDåªèƒ½åŒ…å«å°å†™å­—æ¯ã€æ•°å­—å’Œä¸‹åˆ’çº¿ï¼Œä¸”å¿…é¡»ä»¥å­—æ¯å¼€å¤´', 'error');
                        return;
                    }
                }
                this.step++;
            },
            
            loadTemplate() {
                this.form.code = `"""
${this.form.cn_name || 'æ’ä»¶åç§°'}
æè¿°ï¼š${this.form.description || 'è¿™ä¸ªæ’ä»¶åšä»€ä¹ˆ'}
ä½œè€…ï¼š${this.form.author || 'ä½ çš„åå­—'}
"""

import re
from typing import Optional, Dict, Any


class Plugin:
    """æ’ä»¶ä¸»ç±»"""
    
    def __init__(self):
        self.name = "${this.form.id || 'my_plugin'}"
        self.cn_name = "${this.form.cn_name || 'æ’ä»¶ä¸­æ–‡å'}"
        self.description = "${this.form.description || 'æ’ä»¶æè¿°'}"
        self.version = "${this.form.version || '1.0.0'}"
        self.author = "${this.form.author || 'ä½œè€…'}"
        
        # è§¦å‘å…³é”®è¯ï¼ˆæ­£åˆ™è¡¨è¾¾å¼ï¼‰
        self.triggers = [
            r"å…³é”®è¯1",
            r"å…³é”®è¯2",
        ]
    
    def can_handle(self, message: str) -> bool:
        """æ£€æŸ¥æ˜¯å¦åº”è¯¥å¤„ç†è¿™æ¡æ¶ˆæ¯"""
        for trigger in self.triggers:
            if re.search(trigger, message, re.IGNORECASE):
                return True
        return False
    
    async def handle(self, message: str, context: Dict[str, Any]) -> Optional[str]:
        """
        å¤„ç†æ¶ˆæ¯å¹¶è¿”å›å“åº”
        
        Args:
            message: ç”¨æˆ·å‘é€çš„æ¶ˆæ¯
            context: ä¸Šä¸‹æ–‡ä¿¡æ¯
        
        Returns:
            å“åº”æ–‡æœ¬ï¼Œæˆ– None è¡¨ç¤ºä¸å“åº”
        """
        # åœ¨è¿™é‡Œå®ç°ä½ çš„é€»è¾‘
        return "è¿™æ˜¯æ’ä»¶çš„å›å¤ï¼"


# å¯¼å‡ºæ’ä»¶å®ä¾‹
plugin = Plugin()
`;
            },
            
            resetForm() {
                this.step = 1;
                this.form = {
                    id: '',
                    cn_name: '',
                    author: '',
                    version: '1.0.0',
                    category: 'å¨±ä¹',
                    description: '',
                    full_description: '',
                    features_text: '',
                    usage: '',
                    commands_text: '',
                    changelog: 'v1.0.0 - åˆå§‹ç‰ˆæœ¬',
                    notes: '',
                    code: ''
                };
            },
            
            async submit() {
                if (!this.form.code) {
                    this.showToast('è¯·å¡«å†™æ’ä»¶ä»£ç ', 'error');
                    return;
                }
                
                this.submitting = true;
                
                try {
                    const features = this.form.features_text
                        .split('\n')
                        .map(f => f.trim())
                        .filter(f => f);
                    
                    const commands = this.form.commands_text
                        .split(/[,ï¼Œ]/)
                        .map(c => c.trim())
                        .filter(c => c);
                    
                    const res = await fetch('/api/submit', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            id: this.form.id,
                            cn_name: this.form.cn_name,
                            author: this.form.author,
                            version: this.form.version,
                            category: this.form.category,
                            description: this.form.description,
                            full_description: this.form.full_description || this.form.description,
                            features: features,
                            usage: this.form.usage,
                            commands: commands,
                            changelog: this.form.changelog,
                            notes: this.form.notes,
                            code: this.form.code
                        })
                    });
                    
                    const data = await res.json();
                    
                    if (data.success) {
                        this.showSuccess = true;
                    } else {
                        this.showToast(data.error || 'æäº¤å¤±è´¥', 'error');
                    }
                } catch (e) {
                    this.showToast('æäº¤å¤±è´¥: ' + e.message, 'error');
                } finally {
                    this.submitting = false;
                }
            }
        }
    }
    </script>
</body>
</html>

